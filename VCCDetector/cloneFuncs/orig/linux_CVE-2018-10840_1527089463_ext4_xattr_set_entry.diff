--- ext4_xattr_set_entry_OLD.c	2021-12-06 23:41:02.945189900 +0800
+++ ext4_xattr_set_entry_NEW.c	2021-12-06 23:41:02.945189900 +0800
@@ -131,7 +131,7 @@
 
 	/* No failures allowed past this point. */
 
-	if (!s->not_found && here->e_value_offs) {
+	if (!s->not_found && here->e_value_size && here->e_value_offs) {
 		/* Remove the old value. */
 		void *first_val = s->base + min_offs;
 		size_t offs = le16_to_cpu(here->e_value_offs);
