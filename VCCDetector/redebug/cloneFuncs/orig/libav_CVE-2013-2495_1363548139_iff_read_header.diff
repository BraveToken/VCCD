--- iff_read_header_OLD.c	2021-12-06 23:24:07.367443800 +0800
+++ iff_read_header_NEW.c	2021-12-06 23:24:07.367443800 +0800
@@ -56,6 +56,11 @@
             break;
 
         case ID_CMAP:
+            if (data_size < 3 || data_size > 768 || data_size % 3) {
+                 av_log(s, AV_LOG_ERROR, "Invalid CMAP chunk size %d\n",
+                        data_size);
+                 return AVERROR_INVALIDDATA;
+            }
             st->codec->extradata_size = data_size;
             st->codec->extradata      = av_malloc(data_size);
             if (!st->codec->extradata)
