--- pvscsi_ring_init_msg_OLD.c	2021-12-06 23:59:22.849424600 +0800
+++ pvscsi_ring_init_msg_NEW.c	2021-12-06 23:59:22.850424100 +0800
@@ -1,10 +1,13 @@
-static void
+static int
 pvscsi_ring_init_msg(PVSCSIRingInfo *m, PVSCSICmdDescSetupMsgRing *ri)
 {
     int i;
     uint32_t len_log2;
     uint32_t ring_size;
 
+    if (ri->numPages > PVSCSI_SETUP_MSG_RING_MAX_NUM_PAGES) {
+        return -1;
+    }
     ring_size = ri->numPages * PVSCSI_MAX_NUM_MSG_ENTRIES_PER_PAGE;
     len_log2 = pvscsi_log2(ring_size - 1);
 
@@ -24,4 +27,6 @@
 
     /* Flush ring state page changes */
     smp_wmb();
+
+    return 0;
 }
