--- madvise_remove_OLD.c	2021-12-06 23:28:15.116816300 +0800
+++ madvise_remove_NEW.c	2021-12-06 23:28:15.116816300 +0800
@@ -12,6 +12,9 @@
 			return -EINVAL;
 	}
 
+	if ((vma->vm_flags & (VM_SHARED|VM_WRITE)) != (VM_SHARED|VM_WRITE))
+		return -EACCES;
+
 	mapping = vma->vm_file->f_mapping;
 
 	offset = (loff_t)(start - vma->vm_start)
