--- virgl_cmd_get_capset_OLD.c	2021-12-07 00:02:31.517805500 +0800
+++ virgl_cmd_get_capset_NEW.c	2021-12-07 00:02:31.517805500 +0800
@@ -10,6 +10,10 @@
 
     virgl_renderer_get_cap_set(gc.capset_id, &max_ver,
                                &max_size);
+    if (!max_size) {
+        cmd->error = VIRTIO_GPU_RESP_ERR_INVALID_PARAMETER;
+        return;
+    }
     resp = g_malloc0(sizeof(*resp) + max_size);
 
     resp->hdr.type = VIRTIO_GPU_RESP_OK_CAPSET;
