--- smacker_decode_header_tree_OLD.c	2021-12-06 23:17:55.930884900 +0800
+++ smacker_decode_header_tree_NEW.c	2021-12-06 23:17:55.930884900 +0800
@@ -84,6 +84,11 @@
     if(ctx.last[0] == -1) ctx.last[0] = huff.current++;
     if(ctx.last[1] == -1) ctx.last[1] = huff.current++;
     if(ctx.last[2] == -1) ctx.last[2] = huff.current++;
+    if(huff.current > huff.length){
+        ctx.last[0] = ctx.last[1] = ctx.last[2] = 1;
+        av_log(smk->avctx, AV_LOG_ERROR, "bigtree damaged\n");
+        return -1;
+    }
 
     *recodes = huff.values;
 
