--- X509_to_X509_REQ_OLD.c	2021-12-06 23:51:29.931258800 +0800
+++ X509_to_X509_REQ_NEW.c	2021-12-06 23:51:29.931258800 +0800
@@ -23,6 +23,8 @@
         goto err;
 
     pktmp = X509_get_pubkey(x);
+    if (pktmp == NULL)
+        goto err;
     i = X509_REQ_set_pubkey(ret, pktmp);
     EVP_PKEY_free(pktmp);
     if (!i)
