--- ssl3_client_hello_OLD.c	2021-12-06 23:51:19.837284300 +0800
+++ ssl3_client_hello_NEW.c	2021-12-06 23:51:19.838253100 +0800
@@ -71,8 +71,9 @@
         } else
             i = 1;
 
-        if (i)
-            ssl_fill_hello_random(s, 0, p, sizeof(s->s3->client_random));
+        if (i && ssl_fill_hello_random(s, 0, p,
+                                       sizeof(s->s3->client_random)) <= 0)
+            goto err;
 
         /* Do the message type and length last */
         d = p = ssl_handshake_start(s);
