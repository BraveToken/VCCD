--- free_xenheap_pages_OLD.c	2021-12-07 00:12:09.278535500 +0800
+++ free_xenheap_pages_NEW.c	2021-12-07 00:12:09.278535500 +0800
@@ -1,17 +1,11 @@
 void free_xenheap_pages(void *v, unsigned int order)
 {
-    struct page_info *pg;
-    unsigned int i;
-
     ASSERT(!in_irq());
 
     if ( v == NULL )
         return;
 
-    pg = virt_to_page(v);
-
-    for ( i = 0; i < (1u << order); i++ )
-        pg[i].count_info &= ~PGC_xen_heap;
+    memguard_guard_range(v, 1 << (order + PAGE_SHIFT));
 
-    free_heap_pages(pg, order);
+    free_heap_pages(virt_to_page(v), order);
 }
