--- __gnttab_swap_grant_ref_OLD.c	2021-12-07 00:13:49.256142700 +0800
+++ __gnttab_swap_grant_ref_NEW.c	2021-12-07 00:13:49.256142700 +0800
@@ -8,6 +8,9 @@
 
     spin_lock(&gt->lock);
 
+    if ( gt->gt_version == 0 )
+        PIN_FAIL(out, GNTST_general_error, "grant table not yet set up\n");
+
     /* Bounds check on the grant refs */
     if ( unlikely(ref_a >= nr_grant_entries(d->grant_table)))
         PIN_FAIL(out, GNTST_bad_gntref, "Bad ref-a (%d).\n", ref_a);
