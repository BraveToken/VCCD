--- emulate_privileged_op_OLD.c	2021-12-07 00:11:15.618055700 +0800
+++ emulate_privileged_op_NEW.c	2021-12-07 00:11:15.619059400 +0800
@@ -147,10 +147,10 @@
                     break;
                 }
             }
-            else
-                read_descriptor(data_sel, v, regs,
-                                &data_base, &data_limit, &ar,
-                                0);
+            else if ( !read_descriptor(data_sel, v, regs,
+                                       &data_base, &data_limit, &ar, 0) ||
+                      !(ar & _SEGMENT_S) || !(ar & _SEGMENT_P) )
+                goto fail;
             data_limit = ~0UL;
             ar = _SEGMENT_WR|_SEGMENT_S|_SEGMENT_DPL|_SEGMENT_P;
         }
