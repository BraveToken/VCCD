--- send_reply_OLD.c	2021-12-07 00:11:26.579713900 +0800
+++ send_reply_NEW.c	2021-12-07 00:11:26.579713900 +0800
@@ -3,6 +3,11 @@
 {
 	struct buffered_data *bdata;
 
+	if ( len > XENSTORE_PAYLOAD_MAX ) {
+		send_error(conn, E2BIG);
+		return;
+	}
+
 	/* Message is a child of the connection context for auto-cleanup. */
 	bdata = new_buffer(conn);
 	bdata->buffer = talloc_array(bdata, char, len);
