--- v9fs_wstat_OLD.c	2021-12-07 00:01:14.796982000 +0800
+++ v9fs_wstat_NEW.c	2021-12-07 00:01:14.796982000 +0800
@@ -8,6 +8,7 @@
     struct stat stbuf;
     V9fsFidState *fidp;
     V9fsPDU *pdu = opaque;
+    V9fsState *s = pdu->s;
 
     v9fs_stat_init(&v9stat);
     err = pdu_unmarshal(pdu, offset, "dwS", &fid, &unused, &v9stat);
@@ -73,7 +74,9 @@
         }
     }
     if (v9stat.name.size != 0) {
+        v9fs_path_write_lock(s);
         err = v9fs_complete_rename(pdu, fidp, -1, &v9stat.name);
+        v9fs_path_unlock(s);
         if (err < 0) {
             goto out;
         }
