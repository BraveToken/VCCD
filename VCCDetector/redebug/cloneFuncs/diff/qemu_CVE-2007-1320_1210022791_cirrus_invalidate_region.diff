--- cirrus_invalidate_region_OLD.c	2021-12-06 23:54:51.673680000 +0800
+++ cirrus_invalidate_region_NEW.c	2021-12-06 23:54:51.673680000 +0800
@@ -8,7 +8,7 @@
 
     for (y = 0; y < lines; y++) {
 	off_cur = off_begin;
-	off_cur_end = off_cur + bytesperline;
+	off_cur_end = (off_cur + bytesperline) & s->cirrus_addr_mask;
 	off_cur &= TARGET_PAGE_MASK;
 	while (off_cur < off_cur_end) {
 	    cpu_physical_memory_set_dirty(s->vram_offset + off_cur);
