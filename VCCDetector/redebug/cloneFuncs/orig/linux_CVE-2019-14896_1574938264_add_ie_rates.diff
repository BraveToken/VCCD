--- add_ie_rates_OLD.c	2021-12-06 23:44:04.778858900 +0800
+++ add_ie_rates_NEW.c	2021-12-06 23:44:04.778858900 +0800
@@ -4,6 +4,10 @@
 	int hw, ap, ap_max = ie[1];
 	u8 hw_rate;
 
+	if (ap_max > MAX_RATES) {
+		lbs_deb_assoc("invalid rates\n");
+		return tlv;
+	}
 	/* Advance past IE header */
 	ie += 2;
 
