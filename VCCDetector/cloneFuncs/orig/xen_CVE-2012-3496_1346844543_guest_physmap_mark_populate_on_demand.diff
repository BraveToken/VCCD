--- guest_physmap_mark_populate_on_demand_OLD.c	2021-12-07 00:08:47.717605900 +0800
+++ guest_physmap_mark_populate_on_demand_NEW.c	2021-12-07 00:08:47.718602600 +0800
@@ -8,7 +8,8 @@
     mfn_t omfn;
     int rc = 0;
 
-    BUG_ON(!paging_mode_translate(d));
+    if ( !paging_mode_translate(d) )
+        return -EINVAL;
 
     rc = p2m_gfn_check_limit(d, gfn, order);
     if ( rc != 0 )
