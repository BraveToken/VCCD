--- keyctl_session_to_parent_OLD.c	2021-12-06 23:30:12.721273900 +0800
+++ keyctl_session_to_parent_NEW.c	2021-12-06 23:30:12.721273900 +0800
@@ -56,7 +56,8 @@
 		goto not_permitted;
 
 	/* the keyrings must have the same UID */
-	if (pcred->tgcred->session_keyring->uid != mycred->euid ||
+	if ((pcred->tgcred->session_keyring &&
+	     pcred->tgcred->session_keyring->uid != mycred->euid) ||
 	    mycred->tgcred->session_keyring->uid != mycred->euid)
 		goto not_permitted;
 
