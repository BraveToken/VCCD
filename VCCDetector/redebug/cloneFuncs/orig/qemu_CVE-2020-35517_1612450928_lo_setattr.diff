--- lo_setattr_OLD.c	2021-12-07 00:02:02.162327700 +0800
+++ lo_setattr_NEW.c	2021-12-07 00:02:02.163326600 +0800
@@ -48,9 +48,9 @@
         if (fi) {
             truncfd = fd;
         } else {
-            sprintf(procname, "%i", ifd);
-            truncfd = openat(lo->proc_self_fd, procname, O_RDWR);
+            truncfd = lo_inode_open(lo, inode, O_RDWR);
             if (truncfd < 0) {
+                errno = -truncfd;
                 goto out_err;
             }
         }
