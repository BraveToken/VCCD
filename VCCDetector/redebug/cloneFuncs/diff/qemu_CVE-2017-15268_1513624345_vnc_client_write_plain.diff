--- vnc_client_write_plain_OLD.c	2021-12-07 00:00:22.504871700 +0800
+++ vnc_client_write_plain_NEW.c	2021-12-07 00:00:22.504871700 +0800
@@ -19,6 +19,11 @@
     if (!ret)
         return 0;
 
+    if (ret >= vs->force_update_offset) {
+        vs->force_update_offset = 0;
+    } else {
+        vs->force_update_offset -= ret;
+    }
     buffer_advance(&vs->output, ret);
 
     if (vs->output.offset == 0) {
