--- vqa_decode_init_OLD.c	2021-12-06 23:18:33.020684900 +0800
+++ vqa_decode_init_NEW.c	2021-12-06 23:18:33.020684900 +0800
@@ -31,6 +31,12 @@
         return -1;
     }
 
+    if (s->width  & (s->vector_width  - 1) ||
+        s->height & (s->vector_height - 1)) {
+        av_log(avctx, AV_LOG_ERROR, "Image size not multiple of block size\n");
+        return AVERROR_INVALIDDATA;
+    }
+
     /* allocate codebooks */
     s->codebook_size = MAX_CODEBOOK_SIZE;
     s->codebook = av_malloc(s->codebook_size);
