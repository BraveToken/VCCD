--- sl_if_print_OLD.c	2021-12-07 00:02:52.321145800 +0800
+++ sl_if_print_NEW.c	2021-12-07 00:02:52.321145800 +0800
@@ -11,6 +11,7 @@
 		return (caplen);
 	}
 
+	caplen -= SLIP_HDRLEN;
 	length -= SLIP_HDRLEN;
 
 	ip = (const struct ip *)(p + SLIP_HDRLEN);
@@ -18,6 +19,11 @@
 	if (ndo->ndo_eflag)
 		sliplink_print(ndo, p, ip, length);
 
+	if (caplen < 1 || length < 1) {
+		ND_PRINT((ndo, "%s", tstr));
+		return (caplen + SLIP_HDRLEN);
+	}
+
 	switch (IP_V(ip)) {
 	case 4:
 	        ip_print(ndo, (const u_char *)ip, length);
