--- SYSCALL_DEFINE0_OLD.c	2021-12-06 23:43:44.485137000 +0800
+++ SYSCALL_DEFINE0_NEW.c	2021-12-06 23:43:44.485137000 +0800
@@ -61,6 +61,11 @@
 	if (MSR_TM_ACTIVE(msr)) {
 		/* We recheckpoint on return. */
 		struct ucontext __user *uc_transact;
+
+		/* Trying to start TM on non TM system */
+		if (!cpu_has_feature(CPU_FTR_TM))
+			goto badframe;
+
 		if (__get_user(uc_transact, &uc->uc_link))
 			goto badframe;
 		if (restore_tm_sigcontexts(current, &uc->uc_mcontext,
