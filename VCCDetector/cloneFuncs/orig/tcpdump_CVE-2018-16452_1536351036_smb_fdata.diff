--- smb_fdata_OLD.c	2021-12-07 00:08:23.558221200 +0800
+++ smb_fdata_NEW.c	2021-12-07 00:08:23.558221200 +0800
@@ -14,7 +14,14 @@
 	    while (buf < maxbuf) {
 		const u_char *buf2;
 		depth++;
-		buf2 = smb_fdata(ndo, buf, fmt, maxbuf, unicodestr);
+		/* Not sure how this relates with the protocol specification,
+		 * but in order to avoid stack exhaustion recurse at most that
+		 * many levels.
+		 */
+		if (depth == 10)
+			ND_PRINT("(too many nested levels, not recursing)");
+		else
+			buf2 = smb_fdata(ndo, buf, fmt, maxbuf, unicodestr);
 		depth--;
 		if (buf2 == NULL)
 		    return(NULL);
