--- xc_dom_build_image_OLD.c	2021-12-07 00:09:26.522842500 +0800
+++ xc_dom_build_image_NEW.c	2021-12-07 00:09:26.523841200 +0800
@@ -29,7 +29,11 @@
         void *ramdiskmap;
 
         unziplen = xc_dom_check_gzip(dom->xch, dom->ramdisk_blob, dom->ramdisk_size);
+        if ( xc_dom_ramdisk_check_size(dom, unziplen) != 0 )
+            unziplen = 0;
+
         ramdisklen = unziplen ? unziplen : dom->ramdisk_size;
+
         if ( xc_dom_alloc_segment(dom, &dom->ramdisk_seg, "ramdisk", 0,
                                   ramdisklen) != 0 )
             goto err;
