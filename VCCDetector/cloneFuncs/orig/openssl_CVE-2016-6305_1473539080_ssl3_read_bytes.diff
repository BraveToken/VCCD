--- ssl3_read_bytes_OLD.c	2021-12-06 23:53:33.155683600 +0800
+++ ssl3_read_bytes_NEW.c	2021-12-06 23:53:33.156680800 +0800
@@ -171,7 +171,11 @@
 
             memcpy(buf, &(rr->data[rr->off]), n);
             buf += n;
-            if (!peek) {
+            if (peek) {
+                /* Mark any zero length record as consumed CVE-2016-6305 */
+                if (SSL3_RECORD_get_length(rr) == 0)
+                    SSL3_RECORD_set_read(rr);
+            } else {
                 SSL3_RECORD_sub_length(rr, n);
                 SSL3_RECORD_add_off(rr, n);
                 if (SSL3_RECORD_get_length(rr) == 0) {
