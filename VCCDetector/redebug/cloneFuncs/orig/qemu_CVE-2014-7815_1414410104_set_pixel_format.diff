--- set_pixel_format_OLD.c	2021-12-06 23:57:42.885757900 +0800
+++ set_pixel_format_NEW.c	2021-12-06 23:57:42.885757900 +0800
@@ -9,6 +9,16 @@
         return;
     }
 
+    switch (bits_per_pixel) {
+    case 8:
+    case 16:
+    case 32:
+        break;
+    default:
+        vnc_client_error(vs);
+        return;
+    }
+
     vs->client_pf.rmax = red_max;
     vs->client_pf.rbits = hweight_long(red_max);
     vs->client_pf.rshift = red_shift;
