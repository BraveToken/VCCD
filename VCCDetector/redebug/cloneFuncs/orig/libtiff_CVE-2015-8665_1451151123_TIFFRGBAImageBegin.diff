--- TIFFRGBAImageBegin_OLD.c	2021-12-06 23:26:03.340264400 +0800
+++ TIFFRGBAImageBegin_NEW.c	2021-12-06 23:26:03.340264400 +0800
@@ -8,6 +8,9 @@
 	int colorchannels;
 	uint16 *red_orig, *green_orig, *blue_orig;
 	int n_color;
+	
+	if( !TIFFRGBAImageOK(tif, emsg) )
+		return 0;
 
 	/* Initialize to normal values */
 	img->row_offset = 0;
