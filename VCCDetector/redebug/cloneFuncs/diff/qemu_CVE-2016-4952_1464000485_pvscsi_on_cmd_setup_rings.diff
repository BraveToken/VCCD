--- pvscsi_on_cmd_setup_rings_OLD.c	2021-12-06 23:59:22.897288100 +0800
+++ pvscsi_on_cmd_setup_rings_NEW.c	2021-12-06 23:59:22.898289700 +0800
@@ -7,7 +7,10 @@
     trace_pvscsi_on_cmd_arrived("PVSCSI_CMD_SETUP_RINGS");
 
     pvscsi_dbg_dump_tx_rings_config(rc);
-    pvscsi_ring_init_data(&s->rings, rc);
+    if (pvscsi_ring_init_data(&s->rings, rc) < 0) {
+        return PVSCSI_COMMAND_PROCESSING_FAILED;
+    }
+
     s->rings_info_valid = TRUE;
     return PVSCSI_COMMAND_PROCESSING_SUCCEEDED;
 }
