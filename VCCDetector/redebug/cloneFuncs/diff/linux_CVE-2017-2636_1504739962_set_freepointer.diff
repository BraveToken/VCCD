--- set_freepointer_OLD.c	2021-12-06 23:39:46.089747100 +0800
+++ set_freepointer_NEW.c	2021-12-06 23:39:46.089747100 +0800
@@ -2,5 +2,9 @@
 {
 	unsigned long freeptr_addr = (unsigned long)object + s->offset;
 
+#ifdef CONFIG_SLAB_FREELIST_HARDENED
+	BUG_ON(object == fp); /* naive detection of double free or corruption */
+#endif
+
 	*(void **)freeptr_addr = freelist_ptr(s, fp, freeptr_addr);
 }
