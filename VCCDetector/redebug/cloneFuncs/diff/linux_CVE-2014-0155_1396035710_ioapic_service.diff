--- ioapic_service_OLD.c	2021-12-06 23:34:42.357106900 +0800
+++ ioapic_service_NEW.c	2021-12-06 23:34:42.357106900 +0800
@@ -28,7 +28,7 @@
 		BUG_ON(ioapic->rtc_status.pending_eoi != 0);
 		ret = kvm_irq_delivery_to_apic(ioapic->kvm, NULL, &irqe,
 				ioapic->rtc_status.dest_map);
-		ioapic->rtc_status.pending_eoi = ret;
+		ioapic->rtc_status.pending_eoi = (ret < 0 ? 0 : ret);
 	} else
 		ret = kvm_irq_delivery_to_apic(ioapic->kvm, NULL, &irqe, NULL);
 
