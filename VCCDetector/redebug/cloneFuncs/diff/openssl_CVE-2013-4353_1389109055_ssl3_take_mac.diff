--- ssl3_take_mac_OLD.c	2021-12-06 23:49:25.893034300 +0800
+++ ssl3_take_mac_NEW.c	2021-12-06 23:49:25.893034300 +0800
@@ -2,7 +2,11 @@
 	{
 	const char *sender;
 	int slen;
-
+	/* If no new cipher setup return immediately: other functions will
+	 * set the appropriate error.
+	 */
+	if (s->s3->tmp.new_cipher == NULL)
+		return;
 	if (s->state & SSL_ST_CONNECT)
 		{
 		sender=s->method->ssl3_enc->server_finished_label;
