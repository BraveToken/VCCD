--- llap_print_OLD.c	2021-12-07 00:03:26.347168400 +0800
+++ llap_print_NEW.c	2021-12-07 00:03:26.347168400 +0800
@@ -8,6 +8,10 @@
 	u_short snet;
 	u_int hdrlen;
 
+	if (!ND_TTEST2(*bp, sizeof(*lp))) {
+		ND_PRINT((ndo, " [|llap]"));
+		return (0);	/* cut short by the snapshot length */
+	}
 	if (length < sizeof(*lp)) {
 		ND_PRINT((ndo, " [|llap %u]", length));
 		return (length);
@@ -19,6 +23,10 @@
 	switch (lp->type) {
 
 	case lapShortDDP:
+		if (!ND_TTEST2(*bp, ddpSSize)) {
+			ND_PRINT((ndo, " [|sddp]"));
+			return (0);	/* cut short by the snapshot length */
+		}
 		if (length < ddpSSize) {
 			ND_PRINT((ndo, " [|sddp %u]", length));
 			return (length);
@@ -35,6 +43,10 @@
 		break;
 
 	case lapDDP:
+		if (!ND_TTEST2(*bp, ddpSize)) {
+			ND_PRINT((ndo, " [|ddp]"));
+			return (0);	/* cut short by the snapshot length */
+		}
 		if (length < ddpSize) {
 			ND_PRINT((ndo, " [|ddp %u]", length));
 			return (length);
