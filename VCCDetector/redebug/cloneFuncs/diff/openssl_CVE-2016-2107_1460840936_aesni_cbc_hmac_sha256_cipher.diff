--- aesni_cbc_hmac_sha256_cipher_OLD.c	2021-12-06 23:52:45.239838900 +0800
+++ aesni_cbc_hmac_sha256_cipher_NEW.c	2021-12-06 23:52:45.239838900 +0800
@@ -122,6 +122,8 @@
             maxpad |= (255 - maxpad) >> (sizeof(maxpad) * 8 - 8);
             maxpad &= 255;
 
+            ret &= constant_time_ge(maxpad, pad);
+
             inp_len = len - (SHA256_DIGEST_LENGTH + pad + 1);
             mask = (0 - ((inp_len - len) >> (sizeof(inp_len) * 8 - 1)));
             inp_len &= mask;
