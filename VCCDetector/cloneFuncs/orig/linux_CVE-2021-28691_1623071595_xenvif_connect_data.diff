--- xenvif_connect_data_OLD.c	2021-12-06 23:47:07.422362800 +0800
+++ xenvif_connect_data_NEW.c	2021-12-06 23:47:07.423379900 +0800
@@ -31,6 +31,11 @@
 	if (IS_ERR(task))
 		goto kthread_err;
 	queue->task = task;
+	/*
+	 * Take a reference to the task in order to prevent it from being freed
+	 * if the thread function returns before kthread_stop is called.
+	 */
+	get_task_struct(task);
 
 	task = kthread_run(xenvif_dealloc_kthread, queue,
 			   "%s-dealloc", queue->name);
