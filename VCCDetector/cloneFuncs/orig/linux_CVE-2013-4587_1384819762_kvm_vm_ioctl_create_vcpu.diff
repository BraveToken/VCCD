--- kvm_vm_ioctl_create_vcpu_OLD.c	2021-12-06 23:33:59.353125200 +0800
+++ kvm_vm_ioctl_create_vcpu_NEW.c	2021-12-06 23:33:59.353125200 +0800
@@ -3,6 +3,9 @@
 	int r;
 	struct kvm_vcpu *vcpu, *v;
 
+	if (id >= KVM_MAX_VCPUS)
+		return -EINVAL;
+
 	vcpu = kvm_arch_vcpu_create(kvm, id);
 	if (IS_ERR(vcpu))
 		return PTR_ERR(vcpu);
