--- decode_init_OLD.c	2021-12-06 23:18:15.533475400 +0800
+++ decode_init_NEW.c	2021-12-06 23:18:15.533475400 +0800
@@ -24,6 +24,10 @@
         c->palsize = 127;
     } else {
         c->palsize = AV_RL16(avctx->extradata + 10);
+        if (c->palsize >= MAX_PALSIZE) {
+            av_log(avctx, AV_LOG_ERROR, "KMVC palette too large\n");
+            return AVERROR_INVALIDDATA;
+        }
     }
 
     if (avctx->extradata_size == 1036) {        // palette in extradata
