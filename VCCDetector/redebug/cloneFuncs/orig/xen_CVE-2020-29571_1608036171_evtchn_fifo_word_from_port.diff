--- evtchn_fifo_word_from_port_OLD.c	2021-12-07 00:17:50.759219500 +0800
+++ evtchn_fifo_word_from_port_NEW.c	2021-12-07 00:17:50.759219500 +0800
@@ -3,6 +3,13 @@
 {
     unsigned int p, w;
 
+    /*
+     * Callers aren't required to hold d->event_lock, so we need to synchronize
+     * with evtchn_fifo_init_control() setting d->evtchn_port_ops /after/
+     * d->evtchn_fifo.
+     */
+    smp_rmb();
+
     if ( unlikely(port >= d->evtchn_fifo->num_evtchns) )
         return NULL;
 
