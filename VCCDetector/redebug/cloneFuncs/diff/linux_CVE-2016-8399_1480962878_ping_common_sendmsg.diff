--- ping_common_sendmsg_OLD.c	2021-12-06 23:37:56.591610400 +0800
+++ ping_common_sendmsg_NEW.c	2021-12-06 23:37:56.591610400 +0800
@@ -5,6 +5,10 @@
 	if (len > 0xFFFF)
 		return -EMSGSIZE;
 
+	/* Must have at least a full ICMP header. */
+	if (len < icmph_len)
+		return -EINVAL;
+
 	/*
 	 *	Check the flags.
 	 */
