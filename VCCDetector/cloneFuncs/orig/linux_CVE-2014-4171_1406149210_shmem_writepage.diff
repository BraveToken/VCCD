--- shmem_writepage_OLD.c	2021-12-06 23:35:26.928895200 +0800
+++ shmem_writepage_NEW.c	2021-12-06 23:35:26.928895200 +0800
@@ -45,7 +45,7 @@
 			spin_lock(&inode->i_lock);
 			shmem_falloc = inode->i_private;
 			if (shmem_falloc &&
-			    !shmem_falloc->mode &&
+			    !shmem_falloc->waitq &&
 			    index >= shmem_falloc->start &&
 			    index < shmem_falloc->next)
 				shmem_falloc->nr_unswapped++;
