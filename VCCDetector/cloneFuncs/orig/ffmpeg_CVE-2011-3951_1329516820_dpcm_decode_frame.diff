--- dpcm_decode_frame_OLD.c	2021-12-06 23:18:12.209347100 +0800
+++ dpcm_decode_frame_NEW.c	2021-12-06 23:18:12.210344300 +0800
@@ -11,6 +11,11 @@
     int stereo = s->channels - 1;
     int16_t *output_samples;
 
+    if (stereo && (buf_size & 1)) {
+        buf_size--;
+        buf_end--;
+    }
+
     /* calculate output size */
     switch(avctx->codec->id) {
     case CODEC_ID_ROQ_DPCM:
@@ -145,5 +150,5 @@
     *got_frame_ptr   = 1;
     *(AVFrame *)data = s->frame;
 
-    return buf_size;
+    return avpkt->size;
 }
