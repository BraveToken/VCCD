--- ssl3_write_bytes_OLD.c	2021-12-06 23:51:39.053884000 +0800
+++ ssl3_write_bytes_NEW.c	2021-12-06 23:51:39.053884000 +0800
@@ -168,7 +168,7 @@
 
             i = ssl3_write_pending(s, type, &buf[tot], nw);
             if (i <= 0) {
-                if (i < 0) {
+                if (i < 0 && (!s->wbio || !BIO_should_retry(s->wbio))) {
                     OPENSSL_free(wb->buf);
                     wb->buf = NULL;
                 }
