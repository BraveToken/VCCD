--- gnttab_copy_release_buf_OLD.c	2021-12-07 00:16:34.845255400 +0800
+++ gnttab_copy_release_buf_NEW.c	2021-12-07 00:16:34.846251200 +0800
@@ -5,6 +5,11 @@
         unmap_domain_page(buf->virt);
         buf->virt = NULL;
     }
+    if ( buf->have_grant )
+    {
+        release_grant_for_copy(buf->domain, buf->ptr.u.ref, buf->read_only);
+        buf->have_grant = 0;
+    }
     if ( buf->have_type )
     {
         put_page_type(buf->page);
@@ -15,9 +20,4 @@
         put_page(buf->page);
         buf->page = NULL;
     }
-    if ( buf->have_grant )
-    {
-        release_grant_for_copy(buf->domain, buf->ptr.u.ref, buf->read_only);
-        buf->have_grant = 0;
-    }
 }
