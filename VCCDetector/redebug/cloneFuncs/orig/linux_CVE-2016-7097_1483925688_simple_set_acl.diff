--- simple_set_acl_OLD.c	2021-12-06 23:37:53.135851900 +0800
+++ simple_set_acl_NEW.c	2021-12-06 23:37:53.135851900 +0800
@@ -3,11 +3,10 @@
 	int error;
 
 	if (type == ACL_TYPE_ACCESS) {
-		error = posix_acl_equiv_mode(acl, &inode->i_mode);
-		if (error < 0)
-			return 0;
-		if (error == 0)
-			acl = NULL;
+		error = posix_acl_update_mode(inode,
+				&inode->i_mode, &acl);
+		if (error)
+			return error;
 	}
 
 	inode->i_ctime = current_time(inode);
