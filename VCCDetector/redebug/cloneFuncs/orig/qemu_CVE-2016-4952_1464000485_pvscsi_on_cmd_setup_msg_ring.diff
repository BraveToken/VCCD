--- pvscsi_on_cmd_setup_msg_ring_OLD.c	2021-12-06 23:59:22.927208500 +0800
+++ pvscsi_on_cmd_setup_msg_ring_NEW.c	2021-12-06 23:59:22.928205800 +0800
@@ -11,7 +11,9 @@
     }
 
     if (s->rings_info_valid) {
-        pvscsi_ring_init_msg(&s->rings, rc);
+        if (pvscsi_ring_init_msg(&s->rings, rc) < 0) {
+            return PVSCSI_COMMAND_PROCESSING_FAILED;
+        }
         s->msg_ring_info_valid = TRUE;
     }
     return sizeof(PVSCSICmdDescSetupMsgRing) / sizeof(uint32_t);
