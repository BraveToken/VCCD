--- create_kthread_OLD.c	2021-12-06 23:31:54.122066700 +0800
+++ create_kthread_NEW.c	2021-12-06 23:31:54.122066700 +0800
@@ -8,7 +8,14 @@
 	/* We want our own signal handler (we take no signals by default). */
 	pid = kernel_thread(kthread, create, CLONE_FS | CLONE_FILES | SIGCHLD);
 	if (pid < 0) {
+		/* If user was SIGKILLed, I release the structure. */
+		struct completion *done = xchg(&create->done, NULL);
+
+		if (!done) {
+			kfree(create);
+			return;
+		}
 		create->result = ERR_PTR(pid);
-		complete(&create->done);
+		complete(done);
 	}
 }
