--- check_vma_flags_OLD.c	2021-12-06 23:42:19.684943300 +0800
+++ check_vma_flags_NEW.c	2021-12-06 23:42:19.685940700 +0800
@@ -7,6 +7,9 @@
 	if (vm_flags & (VM_IO | VM_PFNMAP))
 		return -EFAULT;
 
+	if (gup_flags & FOLL_ANON && !vma_is_anonymous(vma))
+		return -EFAULT;
+
 	if (write) {
 		if (!(vm_flags & VM_WRITE)) {
 			if (!(gup_flags & FOLL_FORCE))
