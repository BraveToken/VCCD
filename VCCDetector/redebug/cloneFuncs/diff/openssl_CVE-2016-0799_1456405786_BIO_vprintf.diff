--- BIO_vprintf_OLD.c	2021-12-06 23:52:31.540479800 +0800
+++ BIO_vprintf_NEW.c	2021-12-06 23:52:31.541505200 +0800
@@ -11,7 +11,11 @@
     int ignored;
 
     dynbuf = NULL;
-    _dopr(&hugebufp, &dynbuf, &hugebufsize, &retlen, &ignored, format, args);
+    if (!_dopr(&hugebufp, &dynbuf, &hugebufsize, &retlen, &ignored, format,
+                args)) {
+        OPENSSL_free(dynbuf);
+        return -1;
+    }
     if (dynbuf) {
         ret = BIO_write(bio, dynbuf, (int)retlen);
         OPENSSL_free(dynbuf);
