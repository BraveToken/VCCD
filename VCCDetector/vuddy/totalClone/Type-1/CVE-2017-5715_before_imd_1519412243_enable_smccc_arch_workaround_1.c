static int enable_smccc_arch_workaround_1(void *data)
{
    struct arm_smccc_res res;
    static bool warned = false;
    const struct arm_cpu_capabilities *entry = data;

    /*
     * Enable callbacks are called on every CPU based on the
     * capabilities. So double-check whether the CPU matches the
     * entry.
     */
    if ( !entry->matches(entry) )
        return 0;

    if ( smccc_ver < SMCCC_VERSION(1, 1) )
        goto warn;

    arm_smccc_1_1_smc(ARM_SMCCC_ARCH_FEATURES_FID,
                      ARM_SMCCC_ARCH_WORKAROUND_1_FID, &res);
    if ( res.a0 != ARM_SMCCC_SUCCESS )
        goto warn;

    return !install_bp_hardening_vec(entry,__smccc_workaround_1_smc_start,
                                     __smccc_workaround_1_smc_end,
                                     "call ARM_SMCCC_ARCH_WORKAROUND_1");

warn:
    if ( !warned )
    {
        ASSERT(system_state < SYS_STATE_active);
        warning_add("No support for ARM_SMCCC_ARCH_WORKAROUND_1.\n"
                    "Please update your firmware.\n");
        warned = false;
    }

    return 0;
}
