--- ivi_decode_blocks_OLD.c	2021-12-06 23:19:12.324587800 +0800
+++ ivi_decode_blocks_NEW.c	2021-12-06 23:19:12.324587800 +0800
@@ -74,6 +74,11 @@
             }
 
             if (cbp & 1) { /* block coded ? */
+                if (!band->scan) {
+                    av_log(avctx, AV_LOG_ERROR, "Scan pattern is not set.\n");
+                    return AVERROR_INVALIDDATA;
+                }
+
                 scan_pos = -1;
                 memset(trvec, 0, num_coeffs*sizeof(trvec[0])); /* zero transform vector */
                 memset(col_flags, 0, sizeof(col_flags));      /* zero column flags */
