--- usb_mtp_object_readdir_OLD.c	2021-12-07 00:01:03.957972000 +0800
+++ usb_mtp_object_readdir_NEW.c	2021-12-07 00:01:03.958969400 +0800
@@ -2,13 +2,18 @@
 {
     struct dirent *entry;
     DIR *dir;
+    int fd;
 
     if (o->have_children) {
         return;
     }
     o->have_children = true;
 
-    dir = opendir(o->path);
+    fd = open(o->path, O_DIRECTORY | O_CLOEXEC | O_NOFOLLOW);
+    if (fd < 0) {
+        return;
+    }
+    dir = fdopendir(fd);
     if (!dir) {
         return;
     }
