--- ath11k_mac_op_set_key_OLD.c	2021-12-06 23:46:07.138620000 +0800
+++ ath11k_mac_op_set_key_NEW.c	2021-12-06 23:46:07.139622300 +0800
@@ -40,6 +40,12 @@
 	 */
 	spin_lock_bh(&ab->base_lock);
 	peer = ath11k_peer_find(ab, arvif->vdev_id, peer_addr);
+
+	/* flush the fragments cache during key (re)install to
+	 * ensure all frags in the new frag list belong to the same key.
+	 */
+	if (peer && cmd == SET_KEY)
+		ath11k_peer_frags_flush(ar, peer);
 	spin_unlock_bh(&ab->base_lock);
 
 	if (!peer) {
