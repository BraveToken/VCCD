--- virtio_net_load_OLD.c	2021-12-06 23:55:55.572776300 +0800
+++ virtio_net_load_NEW.c	2021-12-06 23:55:55.572776300 +0800
@@ -81,6 +81,11 @@
         }
 
         n->curr_queues = qemu_get_be16(f);
+        if (n->curr_queues > n->max_queues) {
+            error_report("virtio-net: curr_queues %x > max_queues %x",
+                         n->curr_queues, n->max_queues);
+            return -1;
+        }
         for (i = 1; i < n->curr_queues; i++) {
             n->vqs[i].tx_waiting = qemu_get_be32(f);
         }
