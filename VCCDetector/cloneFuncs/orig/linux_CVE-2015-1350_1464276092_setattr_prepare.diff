--- setattr_prepare_OLD.c	2021-12-06 23:36:16.063480600 +0800
+++ setattr_prepare_NEW.c	2021-12-06 23:36:16.063480600 +0800
@@ -15,7 +15,7 @@
 
 	/* If force is set do it anyway. */
 	if (ia_valid & ATTR_FORCE)
-		return 0;
+		goto kill_priv;
 
 	/* Make sure a caller can chown. */
 	if ((ia_valid & ATTR_UID) &&
@@ -48,5 +48,15 @@
 			return -EPERM;
 	}
 
+kill_priv:
+	/* User has permission for the change */
+	if (ia_valid & ATTR_KILL_PRIV) {
+		int error;
+
+		error = security_inode_killpriv(dentry);
+		if (error)
+			return error;
+	}
+
 	return 0;
 }
