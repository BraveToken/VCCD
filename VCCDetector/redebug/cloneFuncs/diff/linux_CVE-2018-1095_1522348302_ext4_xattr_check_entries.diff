--- ext4_xattr_check_entries_OLD.c	2021-12-06 23:42:05.208660700 +0800
+++ ext4_xattr_check_entries_NEW.c	2021-12-06 23:42:05.208660700 +0800
@@ -14,10 +14,13 @@
 
 	/* Check the values */
 	while (!IS_LAST_ENTRY(entry)) {
-		if (entry->e_value_size != 0 &&
-		    entry->e_value_inum == 0) {
+		u32 size = le32_to_cpu(entry->e_value_size);
+
+		if (size > INT_MAX)
+			return -EFSCORRUPTED;
+
+		if (size != 0 && entry->e_value_inum == 0) {
 			u16 offs = le16_to_cpu(entry->e_value_offs);
-			u32 size = le32_to_cpu(entry->e_value_size);
 			void *value;
 
 			/*
