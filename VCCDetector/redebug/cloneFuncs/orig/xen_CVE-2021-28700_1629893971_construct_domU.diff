--- construct_domU_OLD.c	2021-12-07 00:18:40.099250400 +0800
+++ construct_domU_NEW.c	2021-12-07 00:18:40.099250400 +0800
@@ -19,7 +19,8 @@
 
     if ( vcpu_create(d, 0) == NULL )
         return -ENOMEM;
-    d->max_pages = ~0U;
+
+    d->max_pages = ((paddr_t)mem * SZ_1K) >> PAGE_SHIFT;
 
     kinfo.d = d;
 
