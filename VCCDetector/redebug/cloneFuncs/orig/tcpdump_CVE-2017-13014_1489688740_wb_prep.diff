--- wb_prep_OLD.c	2021-12-07 00:05:31.897369500 +0800
+++ wb_prep_NEW.c	2021-12-07 00:05:31.897369500 +0800
@@ -7,9 +7,8 @@
 	const u_char *ep = ndo->ndo_snapend;
 
 	ND_PRINT((ndo, " wb-prep:"));
-	if (len < sizeof(*prep)) {
+	if (len < sizeof(*prep) || !ND_TTEST(*prep))
 		return (-1);
-	}
 	n = EXTRACT_32BITS(&prep->pp_n);
 	ps = (const struct pgstate *)(prep + 1);
 	while (--n >= 0 && ND_TTEST(*ps)) {
